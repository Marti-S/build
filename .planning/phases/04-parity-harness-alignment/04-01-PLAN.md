---
phase: 04-parity-harness-alignment
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - scripts/parity-test.js
autonomous: true

must_haves:
  truths:
    - "Parity harness invokes OpenCode baseline commands without slash-colon mismatches when baseline=opencode"
    - "Parity report flags missing execute-phase SUMMARY artifacts with a clear, actionable failure"
    - "Parity output still generates a report even when SUMMARY artifacts are missing"
  artifacts:
    - path: "scripts/parity-test.js"
      provides: "Baseline-aware command mapping for plan/execute runs"
    - path: "scripts/parity-test.js"
      provides: "Execute-phase SUMMARY presence checks and report output"
  key_links:
    - from: "scripts/parity-test.js"
      to: "baseline plan/execute commands"
      via: "baseline selection (claude vs opencode)"
      pattern: "baseline.*opencode.*gsd-plan-phase"
    - from: "scripts/parity-test.js"
      to: "parity report"
      via: "SUMMARY presence check"
      pattern: "SUMMARY"
---

<objective>
Align the parity harness to handle OpenCode command names and fail clearly when execute-phase summaries are missing.

Purpose: Ensure parity runs are baseline-correct and actionable when execute outputs are absent.
Output: Updated parity harness logic and report content in `scripts/parity-test.js`.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/v1.0-v1.0-MILESTONE-AUDIT.md
@scripts/parity-test.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add baseline-aware plan/execute command mapping</name>
  <files>scripts/parity-test.js</files>
  <action>
    - Introduce baseline-specific plan/execute command strings that use `/gsd-plan-phase` + `/gsd-execute-phase` when `options.baseline === 'opencode'`, and `/gsd:plan-phase` + `/gsd:execute-phase` otherwise.
    - Keep Codex runs on `/gsd:plan-phase` and `/gsd:execute-phase` (no change to Codex command naming).
    - Use separate variables for codex and baseline commands so logs and error messages show the exact command executed.
    - Preserve existing flags (`--skip-research --skip-verify`) for plan-phase and leave execute-phase flags unchanged.
  </action>
  <verify>Run a parity test with `--baseline opencode` and confirm the baseline plan/execute log files show `/gsd-plan-phase` and `/gsd-execute-phase` in the command line.</verify>
  <done>Baseline OpenCode runs execute `/gsd-plan-phase` and `/gsd-execute-phase`, while Codex and Claude baselines keep `/gsd:...` commands.</done>
</task>

<task type="auto">
  <name>Task 2: Validate SUMMARY artifacts and report actionable failure</name>
  <files>scripts/parity-test.js</files>
  <action>
    - Add a helper to locate `*-SUMMARY.md` files within the resolved phase directory for each workspace.
    - After execute-phase completes, check for SUMMARY files in both Codex and baseline phase directories.
    - If SUMMARY files are missing in either workspace, mark parity as failed and include a clear message in the report indicating which workspace is missing summaries and advising rerun with a phase that produces SUMMARY outputs.
    - Extend the report to include a Summary Artifacts section that lists SUMMARY files (or explicitly states none found) for both workspaces.
    - Ensure the report is still written even when SUMMARY artifacts are missing; exit code should reflect failure (1).
  </action>
  <verify>Run the parity harness with a phase that does not produce SUMMARY files and confirm the report includes the Summary Artifacts section and a FAIL result with actionable guidance.</verify>
  <done>Parity report explicitly lists SUMMARY artifacts per workspace and fails with clear guidance when any are missing.</done>
</task>

</tasks>

<verification>
- Parity harness runs for `--baseline opencode` without command mismatch and produces a report that highlights SUMMARY artifacts (or missing summaries) for each workspace.
</verification>

<success_criteria>
- OpenCode baseline parity runs use the correct `/gsd-` command names.
- Parity report includes SUMMARY presence details and fails clearly when summaries are missing.
</success_criteria>

<output>
After completion, create `.planning/phases/04-parity-harness-alignment/04-01-SUMMARY.md`
</output>
