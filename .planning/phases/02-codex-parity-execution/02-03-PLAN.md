---
phase: 02-codex-parity-execution
plan: 03
type: execute
wave: 2
depends_on: ["02-01", "02-02"]
files_modified:
  - .planning/parity/02-parity-report.md
  - .planning/phases/02-codex-parity-execution/02-03-SUMMARY.md
autonomous: false

must_haves:
  truths:
    - "Codex and OpenCode runs of the same /gsd command produce structurally equivalent .planning artifacts for the same inputs"
    - "Parity comparison is recorded in a repo-local report"
  artifacts:
    - path: ".planning/parity/02-parity-report.md"
      provides: "Codex vs OpenCode parity comparison notes"
  key_links:
    - from: ".planning/parity/02-parity-report.md"
      to: ".planning/parity/codex-run/.planning"
      via: "artifact snapshot"
      pattern: "codex-run/.planning"
    - from: ".planning/parity/02-parity-report.md"
      to: ".planning/parity/opencode-run/.planning"
      via: "artifact snapshot"
      pattern: "opencode-run/.planning"
---

<objective>
Verify Codex vs OpenCode parity by running the same /gsd command in isolated workspaces and comparing artifacts.

Purpose: Close PARITY-01 by proving structural parity of generated .planning artifacts.
Output: A parity report documenting artifact equivalence (or differences).
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-codex-parity-execution/02-CONTEXT.md
@.planning/phases/02-codex-parity-execution/02-RESEARCH.md

@commands/gsd/plan-phase.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Prepare parity workspaces</name>
  <files>.planning/parity/02-parity-report.md</files>
  <action>
Create isolated workspaces for Codex and OpenCode parity runs.

- Create `.planning/parity/` and remove any prior `codex-run`/`opencode-run` folders inside it.
- Copy the repo into `.planning/parity/codex-run` and `.planning/parity/opencode-run` (exclude `.git` and `node_modules`).
- In each workspace, run the installer for its runtime:
  - Codex: `node bin/install.js --codex --local`
  - OpenCode: `node bin/install.js --opencode --local`
- Pick a parity phase number that does not exist in the workspace (default `98`, fall back to `98.1` if needed) and note it at the top of the report file as `Parity phase: <value>`.
- Create `.planning/parity/02-parity-report.md` with sections for runs, artifact paths, and diff results.
  </action>
  <verify>Confirm both workspaces exist and `.planning/parity/02-parity-report.md` records the parity phase number.</verify>
  <done>Codex/OpenCode workspaces are ready and parity phase is recorded.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Isolated Codex and OpenCode workspaces with runtime installs</what-built>
  <how-to-verify>
    1. In `.planning/parity/codex-run`, run the same command as in OpenCode: `/gsd:plan-phase <parity-phase> --skip-research --skip-verify`.
    2. In `.planning/parity/opencode-run`, run: `/gsd-plan-phase <parity-phase> --skip-research --skip-verify`.
    3. Confirm each workspace creates `.planning/phases/<parity-phase>-*/` with a PLAN.md file.
  </how-to-verify>
  <resume-signal>Type "approved" when both runs finished, or describe issues</resume-signal>
</task>

<task type="auto">
  <name>Task 2: Compare artifacts and write parity report</name>
  <files>.planning/parity/02-parity-report.md; .planning/phases/02-codex-parity-execution/02-03-SUMMARY.md</files>
  <action>
Compare the generated artifacts and record the results.

- Locate the parity phase directories in each workspace (`.planning/parity/codex-run/.planning/phases/<parity-phase>-*` and `.planning/parity/opencode-run/.planning/phases/<parity-phase>-*`).
- Run a recursive diff on those directories (ignore timestamps if any), and capture results in `.planning/parity/02-parity-report.md`.
- Note whether artifacts are structurally equivalent; if differences exist, list the files/sections that differ.
- Create the plan summary using the standard template, referencing the parity report.
  </action>
  <verify>Open `.planning/parity/02-parity-report.md` and confirm it lists both artifact paths and diff results; confirm `.planning/phases/02-codex-parity-execution/02-03-SUMMARY.md` follows the summary template.</verify>
  <done>Parity report documents Codex vs OpenCode artifact equivalence (or differences) and summary is created.</done>
</task>

</tasks>

<verification>
- Codex and OpenCode parity runs produced `.planning/phases/<parity-phase>-*/` directories in their workspaces.
- Parity report lists both artifact paths and diff results.
</verification>

<success_criteria>
- `.planning/parity/02-parity-report.md` documents parity results for the same /gsd command.
- Parity comparison confirms structural equivalence or clearly lists differences.
</success_criteria>

<output>
After completion, create `.planning/phases/02-codex-parity-execution/02-03-SUMMARY.md`
</output>
