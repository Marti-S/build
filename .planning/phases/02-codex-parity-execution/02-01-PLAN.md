---
phase: 02-codex-parity-execution
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - bin/install.js
  - get-shit-done/templates/codex/AGENTS.md
  - .planning/phases/02-codex-parity-execution/02-01-SUMMARY.md
autonomous: true

must_haves:
  truths:
    - "Codex /gsd invocations load the matching commands/gsd/*.md file as canonical instructions"
    - "Codex resolves @~/.claude/get-shit-done/... references to repo-local get-shit-done/... when following command workflows"
    - "Codex guidance stays repo-scoped without altering Claude/OpenCode installs"
    - "Installing Codex support leaves Claude/OpenCode guidance and skills unchanged"
  artifacts:
    - path: "bin/install.js"
      provides: "Codex skill content includes command file pointer and path-mapping guidance"
    - path: "get-shit-done/templates/codex/AGENTS.md"
      provides: "Repo guidance for command-file loading and path mapping"
  key_links:
    - from: "bin/install.js"
      to: ".codex/skills/gsd-*/SKILL.md"
      via: "buildCodexSkillContent"
      pattern: "commands/gsd/.*\\.md"
    - from: "get-shit-done/templates/codex/AGENTS.md"
      to: "commands/gsd/*.md"
      via: "GSD guidance block"
      pattern: "commands/gsd/"
    - from: "get-shit-done/templates/codex/AGENTS.md"
      to: "get-shit-done/"
      via: "path mapping rule"
      pattern: "@~\\/.claude/get-shit-done"
---

<objective>
Make Codex load canonical /gsd command files and resolve workflow references to repo-local paths.

Purpose: Ensure Codex executes the same /gsd flows as Claude/OpenCode without touching user installs.
Output: Updated Codex skill generation and AGENTS guidance for command-file loading and path mapping.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-codex-parity-execution/02-CONTEXT.md
@.planning/phases/02-codex-parity-execution/02-RESEARCH.md

@bin/install.js
@get-shit-done/templates/codex/AGENTS.md
@commands/gsd/plan-phase.md
@commands/gsd/execute-phase.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update Codex skill content and AGENTS guidance</name>
  <files>bin/install.js; get-shit-done/templates/codex/AGENTS.md</files>
  <action>
Update Codex skill generation to include canonical command file loading and repo-local path mapping, and align the Codex AGENTS guidance to match.

- Change `buildCodexSkillContent` to accept the command file path (repo-relative like `commands/gsd/plan-phase.md`).
- Update the function output to instruct Codex to load that command file and follow it as canonical behavior.
- Add a brief rule in the skill content: when command files reference `@~/.claude/get-shit-done/...`, resolve them to repo-local `@get-shit-done/...` paths while running in Codex.
- Pass the command file path from `installCodexLocal` when writing `SKILL.md`.
- Augment the Codex GSD guidance block with:
  - A bullet mapping `/gsd:command` to `commands/gsd/<command>.md` and instructing Codex to read and follow it.
  - A bullet translating `@~/.claude/get-shit-done/...` references to `@get-shit-done/...` in Codex.
- Keep formatting consistent with existing skill content (YAML frontmatter + short imperative instructions) and keep the guidance concise to avoid size limits.
  </action>
  <verify>Run `node bin/install.js --codex --local` and confirm a generated `.codex/skills/gsd-*/SKILL.md` references `commands/gsd/*.md` and the path-mapping rule; confirm the repo `AGENTS.md` GSD block includes the new command-resolution and path-mapping bullets.</verify>
  <done>Codex skills and repo guidance explicitly load canonical command files and document repo-local path mapping.</done>
</task>

<task type="auto">
  <name>Task 2: Verify Claude/OpenCode installs stay unchanged</name>
  <files>bin/install.js</files>
  <action>
Run both Claude and OpenCode install flows and confirm Codex guidance is not injected.

- Run `node bin/install.js --claude --local` and `node bin/install.js --opencode --local`.
- Capture checksums for Claude/OpenCode command + workflow assets before Codex install and verify they remain identical after:
  - Claude: hash `./.claude/commands/gsd/**`, `./.claude/get-shit-done/**`, and `./.claude/agents/gsd-*.md`.
  - OpenCode: hash `./.opencode/command/gsd-*.md`, `./.opencode/get-shit-done/**`, and `./.opencode/agents/gsd-*.md`.
  - Store hashes in temporary files and compare before vs after `node bin/install.js --codex --local`.
- Check the generated Claude/OpenCode AGENTS guidance to ensure there are no Codex-specific bullets (no `commands/gsd/` mapping and no `@~/.claude/get-shit-done` path mapping added outside Codex templates).
- If output locations differ in this repo, follow existing install output paths to inspect the generated AGENTS files.
  </action>
  <verify>Run the install commands, then confirm: (1) before/after checksum files match for Claude/OpenCode command + workflow assets, and (2) AGENTS guidance lacks Codex-specific instructions.</verify>
  <done>Claude/OpenCode installs complete without any Codex-only guidance or command/skill changes being introduced.</done>
</task>

<task type="auto">
  <name>Task 3: Write execution summary</name>
  <files>.planning/phases/02-codex-parity-execution/02-01-SUMMARY.md</files>
  <action>
Create the phase summary using the standard summary template and capture what changed, verification performed, and any follow-ups.

- Use `@~/.config/opencode/get-shit-done/templates/summary.md` as the structure.
- Include references to the updated files and the install checks performed.
  </action>
  <verify>Open `.planning/phases/02-codex-parity-execution/02-01-SUMMARY.md` and confirm it follows the summary template with outcomes and verification results.</verify>
  <done>02-01 summary exists with outcomes and verification notes.</done>
</task>

</tasks>

<verification>
- Codex skill output for at least one command (e.g., plan-phase) references `commands/gsd/plan-phase.md` and includes the path-mapping rule.
- AGENTS.md GSD block contains the command resolution and `@~/.claude/get-shit-done/` mapping guidance.
- Running Claude and OpenCode installs does not introduce Codex-specific guidance in their outputs.
</verification>

<success_criteria>
- Codex skills and AGENTS guidance both direct Codex to the canonical `commands/gsd/*.md` files.
- Repo-local path mapping is documented so Codex can follow workflows and templates without ~/.claude installs.
- Claude/OpenCode installs remain unchanged when adding Codex support.
</success_criteria>

<output>
After completion, create `.planning/phases/02-codex-parity-execution/02-01-SUMMARY.md`
</output>
