---
phase: 01-codex-repo-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - bin/install.js
  - get-shit-done/templates/codex/AGENTS.md
autonomous: true

must_haves:
  truths:
    - "User can run the installer and see /gsd Codex skills under `.codex/skills` in the repo"
    - "Each Codex skill shows the same name and description as its /gsd command"
    - "Repo root `AGENTS.md` includes /gsd usage guidance after install"
  artifacts:
    - path: "bin/install.js"
      provides: "Codex repo install path, skill generation, AGENTS writer"
      contains: "codex"
    - path: "get-shit-done/templates/codex/AGENTS.md"
      provides: "Repo-level GSD guidance template for Codex"
      min_lines: 20
  key_links:
    - from: "bin/install.js"
      to: "commands/gsd"
      via: "frontmatter parse to build SKILL.md"
      pattern: "commands[\\/]gsd"
    - from: "bin/install.js"
      to: ".codex/skills"
      via: "skill directory writes"
      pattern: "\\.codex/skills"
    - from: "bin/install.js"
      to: "get-shit-done/templates/codex/AGENTS.md"
      via: "AGENTS template read"
      pattern: "templates/codex/AGENTS\\.md"
---

<objective>
Add Codex repo install support that generates /gsd skills and repo guidance from existing command metadata.

Purpose: Deliver CODEX-01/02/03 by installing repo-scoped skills and AGENTS guidance without touching user-level Codex config.
Output: Codex skill generator + AGENTS template/writer wired into the installer.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-codex-repo-integration/01-RESEARCH.md
@bin/install.js
@commands/gsd/help.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Generate Codex skills from /gsd command frontmatter</name>
  <files>bin/install.js</files>
  <action>
    Add Codex skill generation helpers that scan `commands/gsd` recursively, parse YAML frontmatter, and emit one `SKILL.md` per command under `.codex/skills/<skill-dir>/`.
    - Derive `<skill-dir>` from the command path using `gsd-` prefix and kebab-case segments (e.g., `commands/gsd/help.md` -> `gsd-help`).
    - Read `name` and `description` from command frontmatter and write them as single-line fields in `SKILL.md` frontmatter; if missing, log a warning and skip that command (do not invent content).
    - Keep the SKILL body minimal and repo-safe: instruct the model to follow `AGENTS.md` guidance for /gsd usage and treat the skill name as the command entrypoint; avoid references to `~/.claude` paths or OpenCode-only syntax.
    - Remove only previously installed GSD skills (directories starting with `gsd-`) before writing new ones; preserve any non-GSD skills in `.codex/skills`.
  </action>
  <verify>node bin/install.js --codex --local</verify>
  <done>`./.codex/skills` contains `gsd-*` directories with SKILL.md whose name/description match command frontmatter.</done>
</task>

<task type="auto">
  <name>Task 2: Add Codex AGENTS.md template and merge logic</name>
  <files>get-shit-done/templates/codex/AGENTS.md, bin/install.js</files>
  <action>
    Create `get-shit-done/templates/codex/AGENTS.md` with repo-level guidance for /gsd usage in Codex.
    - Use ASCII, concise bullet guidance, and include a clearly delimited block with markers `<!-- GSD:START -->` and `<!-- GSD:END -->` for safe updates.
    - In `bin/install.js`, add a writer that installs repo-root `AGENTS.md` during Codex local install:
      - If `AGENTS.md` exists and contains the marker block, replace only the block.
      - If `AGENTS.md` exists without the markers, append the block to the end without altering other content.
      - If `AGENTS.md` does not exist, create it using the template content.
    - Do not create `AGENTS.override.md`, do not edit any Codex config files, and do not alter non-GSD content.
  </action>
  <verify>node bin/install.js --codex --local</verify>
  <done>`AGENTS.md` exists at repo root and contains the GSD guidance block bounded by the markers.</done>
</task>

<task type="auto">
  <name>Task 3: Wire Codex runtime selection into the installer</name>
  <files>bin/install.js</files>
  <action>
    Extend the installer CLI to support Codex as a runtime while keeping Claude/OpenCode behavior unchanged.
    - Add a `--codex` flag, include it in help text and interactive runtime prompt options.
    - Treat Codex as local-only: error with a clear message if `--codex` is combined with `--global` or `--config-dir`.
    - Route Codex installs to a dedicated `install` path that writes `.codex/skills` and `AGENTS.md` (no hooks, no settings.json, no `config.toml`).
    - Ensure mixed installs (`--both` or prompt selection) still work for Claude/OpenCode and allow combining with Codex only when `--local` is selected.
  </action>
  <verify>node bin/install.js --codex --local</verify>
  <done>Installer supports Codex selection and completes a repo install with `.codex/skills` and `AGENTS.md` created.</done>
</task>

</tasks>

<verification>
- Running `node bin/install.js --codex --local` creates `.codex/skills/gsd-*` and a repo-root `AGENTS.md` with the GSD block.
- `SKILL.md` frontmatter `name`/`description` matches `commands/gsd/*.md` frontmatter.
</verification>

<success_criteria>
- Codex local install creates repo-scoped skills and guidance without modifying Claude/OpenCode installs.
- Skills list is discoverable under `.codex/skills` with correct names/descriptions.
</success_criteria>

<output>
After completion, create `.planning/phases/01-codex-repo-integration/01-01-SUMMARY.md`
</output>
